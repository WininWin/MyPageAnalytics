/*! mymind 04-01-2017 */
var app=angular.module("MyPageAnalytics",["appControllers","FBServices","ui.router","ngMaterial","nvd3","angular-jqcloud","ngAnimate"]);app.config(["$stateProvider","$urlRouterProvider","$mdThemingProvider",function(a,b,c){c.theme("default").primaryPalette("light-blue",{default:"400","hue-1":"900","hue-2":"600"}).accentPalette("light-green",{default:"800","hue-1":"400"}).warnPalette("red",{default:"600"}).backgroundPalette("grey",{default:"A100"}),b.otherwise("/"),a.state("app",{url:"/",views:{header:{templateUrl:"partials/header.html"},main:{templateUrl:"partials/login.html"},footer:{templateUrl:"partials/footer.html"}}}).state("app.main",{url:"main",views:{"main@":{templateUrl:"partials/main.html"}}}).state("app.privacy",{url:"privacy",views:{"main@":{templateUrl:"partials/privacyinfo.html"}}})}]),app.run(["$rootScope","$window","$state",function(a,b,c){function d(b){console.log("2.statusChangeCallback"),"connected"===b.status?(a.token=b.authResponse.accessToken,c.go("app.main")):"not_authorized"===b.status?console.log("Please log into this app."):console.log("Please log into Facebook.")}b.fbAsyncInit=function(){FB.init({appId:"780261085443713",cookie:!0,xfbml:!0,version:"v2.8"}),FB.getLoginStatus(function(a){d(a)})},function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/sdk.js",d.parentNode.insertBefore(b,d))}(document)}]);var appControllers=angular.module("appControllers",[]);appControllers.controller("HeaderCtrl",["$rootScope","$state","$window","$scope","$http",function(a,b,c,d,e){}]),appControllers.controller("LoginCtrl",["$rootScope","$state","$window","$scope","$http",function(a,b,c,d,e){a.privacy&&(a.privacy=0,c.location.reload())}]),appControllers.controller("FooterCtrl",["$rootScope","$state","$window","$scope","$http",function(a,b,c,d,e){d.goback=function(){FB&&a.username?b.go("app.main"):(a.privacy=1,b.go("app"))}}]),appControllers.controller("MainCtrl",["$rootScope","$state","$scope","$window","$timeout","$http","FBapi",function(a,b,c,d,e,f,g){function h(){c.watcher=[!1,!1,!1,!1,!1,!1],c.$watch("watcher",function(a,b){a[0]&&(c.done_p_info=!0),a[1]&&(c.done_visited=!0),a[2]&&(c.done_profile=!0),a[3]&&(c.done_word=!0),a[4]&&(c.done_post=!0),a[5]&&(c.done_network=!0)},!0),c.data=[],c.num_names_appear=[],c.done_p_info=!1,c.done_visited=!1,c.done_profile=!1,c.done_word=!1,c.done_post=!1,c.done_network=!1,c.feed_network={nodes:[],links:[]},c.word_filter=["the","a","of","an","in","on","at","for","to","from","as","I","you"],c.final_network,c.profile_link={},c.word_data=[],c.most_likes_profile="",c.img_done=!1,c.number_of_events=[{key:"Number_of_events",bar:!0,values:[]}],c.data_about_me={name:"",total_people_in_feed:0,total_posts_in_feed:0,total_profile_update:0,person_appear_most:""},c.most_visitied_profile="",g.getGraphApi("/me",null).then(function(b){c.data_about_me.name=b.name,a.username=b.name},function(a){console.log(a)});var b=g.getGraphApi("/me/feed",{fields:"message,full_picture,story,created_time,from",limit:500,since:c.myDate.toDateString()});b.then(function(a){c.data=a.data,c.should_get_mode_data=!1,c.should_get_mode_data||i(c.data)},function(a){console.log(a)})}function i(a){var b=[],d={},e=0,f=[],h={},i=0;c.most_visitied_id=0;var j=0,k=0,l=[];0===a.length&&(c.watcher[0]=!0,c.watcher[1]=!0,c.watcher[2]=!0,c.watcher[3]=!0,c.watcher[4]=!0,c.watcher[5]=!0,c.nopost=!0,c.noword=!0,c.noprofile=!0,c.img_done=!0);for(var m=0;m<a.length;m++){var n=a[m].created_time.split(/[^0-9]/),o=new Date(n[0],n[1]-1,n[2]);if(b[m]=a[m].id,a[m].story===c.data_about_me.name+" updated his profile picture."||a[m].story===c.data_about_me.name+" updated her profile picture."){e++,c.profile_link[a[m].id]={},c.profile_link[a[m].id].id=a[m].id,c.profile_link[a[m].id].likes=0,c.profile_link[a[m].id].link=a[m].full_picture;var p=o.getFullYear()+"-"+o.getMonth()+"-"+o.getDate();c.profile_link[a[m].id].created_time=p}if(d[o.getTime()]?d[o.getTime()]++:d[o.getTime()]=1,a[m].message){var q=a[m].message.replace(/[&\/\\#+=~%.,-_:;*<>{}$()]/g,"");q=q.trim(),q=q.replace(/\s\s+/g," "),q=q.replace(/\r?\n|\r/g," ");var r=q.split(" ");l.push(r)}for(var s=0,t=0;t<c.num_names_appear.length;t++)if(a[m].from&&c.num_names_appear[t].key===a[m].from.name){c.num_names_appear[t].y++,j<=c.num_names_appear[t].y&&a[m].from.name!==c.data_about_me.name&&(j=c.num_names_appear[t].y,c.most_visitied_id=a[m].from.id,c.data_about_me.person_appear_most=a[m].from.name),s=1;break}!s&&a[m].from&&a[m].from.name!==c.data_about_me.name&&(i++,c.num_names_appear.push({key:a[m].from.name,y:1})),c.most_visitied_id||a[m].from.name===c.data_about_me.name||(c.most_visitied_id=a[m].from.id),c.data_about_me.total_people_in_feed=i,k++}if(k===a.length){for(var u=0;u<c.num_names_appear.length+1;u++)if(0!==u){var v=0;c.num_names_appear[u-1].y>10?v=1:c.num_names_appear[u-1].y<=10&&c.num_names_appear[u-1].y>6?v=2:c.num_names_appear[u-1].y<=6&&c.num_names_appear[u-1].y>3?gorup=3:v=4,c.feed_network.nodes.push({name:c.num_names_appear[u-1].key,group:v}),c.feed_network.links.push({source:parseInt(u),target:0,value:parseInt(c.num_names_appear[u-1].y)})}else c.feed_network.nodes.push({name:c.data_about_me.name,group:0});c.final_network=c.feed_network,c.watcher[5]=!0,g.getGraphApi("/"+c.most_visitied_id+"/picture",{width:"200",height:"200"}).then(function(a){c.most_visitied_profile=a.data.url,c.img_done=!0});for(var w=0;w<l.length;w++)for(var u=0;u<l[w].length;u++)h[l[w][u]]?h[l[w][u]]++:h[l[w][u]]=1;for(var x in h)x.length<10&&h[x]>1&&" "!==x&&""!==x&&c.word_filter.indexOf(x)===-1&&c.word_data.push({text:x,weight:parseInt(h[x])});c.word_data.sort(function(a,b){return a.weight-b.weight}),0===c.word_data.length&&(c.noword=!0),c.data_about_me.total_posts_in_feed=a.length,c.data_about_me.total_profile_update=e,c.watcher[0]=!0,c.watcher[1]=!0,c.watcher[3]=!0}for(var x in d){var y=[];y[0]=parseInt(x),y[1]=d[x],c.number_of_events[0].values.push(y)}c.number_of_events[0].values.sort(function(a,b){return a[0]-b[0]});for(var z=0;z<c.number_of_events[0].values.length;z++)if(c.number_of_events[0].values[z+1]){var A=c.number_of_events[0].values[z+1][0]-c.number_of_events[0].values[z][0];A>2592e6&&c.number_of_events[0].values.splice(z+1,0,[c.number_of_events[0].values[z][0]+2592e6,0])}if(c.watcher[4]=!0,c.data_about_me.total_profile_update)for(var x in c.profile_link)g.getLikes(x).then(function(a){c.profile_link[a[1]].likes=a[0].summary.total_count,f.push(c.profile_link[a[1]]),f.length===e&&(f.sort(function(a,b){return a.likes-b.likes}),c.most_likes_profile=f[f.length-1].link,c.watcher[2]=!0)});else c.watcher[2]=!0,c.noprofile=!0,c.img_done=!0}c.refresh=function(){h()},c.data_name=["Personal Info","Visited People Chart","Profile Gallery","Words Chart","Post Chart","Social Graph"],c.options_one={chart:{type:"pieChart",height:500,x:function(a){return a.key},y:function(a){return a.y},showLabels:!0,duration:500,labelThreshold:.03,labelSunbeamLayout:!0,showLegend:!1}},c.options_three={chart:{type:"historicalBarChart",height:500,margin:{top:20,right:20,bottom:65,left:50},x:function(a){return a[0]},y:function(a){return a[1]},showValues:!0,valueFormat:function(a){return d3.format(",.1d")(a)},duration:100,xAxis:{axisLabel:"Dates",tickFormat:function(a){return d3.time.format("%x")(new Date(a))},rotateLabels:30,showMaxMin:!1},yAxis:{axisLabel:"Number of Posts",axisLabelDistance:-10,tickFormat:function(a){return d3.format(",.1d")(a)}},tooltip:{keyFormatter:function(a){return d3.time.format("%x")(new Date(a))}}}};var j=d3.scale.category20();c.options_four={chart:{type:"forceDirectedGraph",height:500,width:function(){return nv.utils.windowSize().width}(),margin:{top:20,right:20,bottom:20,left:20},duration:500,color:function(a){return j(a.group)},nodeExtras:function(a){a&&a.append("text").attr("dx",8).attr("dy",".35em").text(function(a){return a.name}).style("font-size","10px")},tooltip:{contentGenerator:function(a){var b=a.series[0],c=a.series[1];if(null!==b.value){var d="<tr><td class='key'>Group: </td><td class='x-value'>"+c.value+"</td></tr>",e="<thead><tr><td class='legend-color-guide'><div style='background-color: "+b.color+";'></div></td><td class='key'><strong>"+b.value+"</strong></td></tr></thead>";return"<table>"+e+"<tbody>"+d+"</tbody></table>"}}}}},c.myDate=new Date("2010/01/01"),d.setTimeout(function(){var b=0;a.token||(console.log("no Token"),b=100,FB.getLoginStatus(function(b){"connected"===b.status&&(a.token=b.authResponse.accessToken)})),d.setTimeout(function(){h()},b)},500)}]);var FBServices=angular.module("FBServices",[]);FBServices.factory("FBapi",["$http","$q","$window","$timeout",function(a,b,c,d){function e(a,c){if("undefined"!=typeof FB){var d=b.defer();return FB.api(a,"get",c,function(a){!a||a.error?d.reject("Error occured"):d.resolve(a)}),d.promise}}function f(a,c){if("undefined"!=typeof FB){var d=b.defer();return FB.api(a,function(a){!a||a.error?d.reject("Error occured"):d.resolve([a,c])}),d.promise}}return{getGraphApi:function(a,b){return e(a,b)},getLikes:function(a){return f("/"+a+"/likes?fields=total_count&summary=true",a)}}}]);